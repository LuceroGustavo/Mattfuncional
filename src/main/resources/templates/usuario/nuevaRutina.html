<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Lexend%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
  <title>Crear Rutina</title>
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <style>
    .swiper-container {
      max-width: 860px;
      overflow: hidden;
    }
    .swiper-slide {
      height: 350px;
      width: 250px !important;
      border-radius: 16px;
      background-color: #d8fafa;
      transition: background-color 0.3s ease, transform 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px;
      cursor: pointer;
    }
    .swiper-slide img {
      height: 70%;
      width: auto;
      object-fit: contain;
      border-radius: 12px;
    }
    .swiper-slide:hover, .swiper-slide.selected {
      background-color: #f5f77f;
      transform: scale(1.05);
      border: 3px solid #8fb1f0;
    }
    .routine-list {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #000;
    }
  </style>
</head>
<body>

<!-- Navbar fragment -->
<div th:replace="fragments/navbar :: navbar"></div>

  <div class="px-40 flex flex-1 justify-center py-5">
    <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
      <h2 class="text-[#0d141c] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">Selecciona Ejercicios para tu Rutina</h2>
      
      <!-- Carrusel de ejercicios -->
      <div id="carrusel-container" class="swiper-container p-4">
        <div class="swiper-wrapper">
          <div th:each="exercise : ${exercises}" class="swiper-slide" onclick="toggleExercise(this)" th:data-id="${exercise.id}">
            <img class="exercise-img" th:src="${exercise.imagen.url}" alt="Exercise Image" />
            <h3 class="text-[#49709c] text-sm font-medium" th:text="${#strings.arrayJoin(exercise.muscleGroups.toArray(), ', ')}">Muscle Group</h3>
            <h2 class="text-[#0d141c] text-base font-medium" th:text="${exercise.name}">Exercise Name</h2>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      
      <h2 class="text-[#0d141c] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">Ejercicios Seleccionados</h2>
      <div class="routine-list" id="routine-list"></div>
      <button onclick="sendRoutine()">Guardar Rutina</button>
    </div>
  </div>
  
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script>
    const swiper = new Swiper('.swiper-container', {
      effect: "coverflow",
      grabCursor: true,
      centeredSlides: true,
      slidesPerView: 'auto',
      spaceBetween: 10,
      coverflowEffect: {
        rotate: 0,
        stretch: 10,
        depth: 80,
        modifier: 2.5,
        slideShadows: true
      },
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      mousewheel: {
        thresholdDelta: 70
      },
      breakpoints: {
        640: {
          slidesPerView: 2,
          spaceBetween: 10,
        },
        768: {
          slidesPerView: 3,
          spaceBetween: 40,
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 50,
        },
      },
    });

    function toggleExercise(slide) {
      slide.classList.toggle("selected");
      updateRoutineList();
    }

    function updateRoutineList() {
      const selectedExercises = document.querySelectorAll(".swiper-slide.selected");
      const routineList = document.getElementById("routine-list");
      routineList.innerHTML = "";
      selectedExercises.forEach(slide => {
        const listItem = document.createElement("div");
        listItem.className = "routine-item";
        listItem.textContent = slide.dataset.id;
        routineList.appendChild(listItem);
      });
    }

    function sendRoutine() {
      const selectedExercises = Array.from(document.querySelectorAll(".swiper-slide.selected"))
                                      .map(slide => slide.dataset.id);
      
      const rutina = {
        nombre: "Mi Rutina",
        usuarioId: 1,
        ejercicios: selectedExercises
      };

      fetch("/rutinas", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(rutina)
      })
      .then(response => {
        if (response.ok) {
          alert("Rutina guardada con Ã©xito");
          location.reload();
        } else {
          alert("Error al guardar la rutina");
        }
      })
      .catch(error => console.error("Error:", error));
    }
  </script>
</body>
</html>
