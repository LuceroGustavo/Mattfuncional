<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Hoja de Rutina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            min-height: 100vh;
        }
        .rutina-header {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #222;
            border-radius: 18px;
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 24px rgba(67,233,123,0.08);
            text-align: center;
        }
        .rutina-header h2 {
            font-weight: 800;
            margin-bottom: 0.2rem;
        }
        .rutina-header .info {
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
        }
        .rutina-header .badge {
            font-size: 1rem;
            margin-left: 0.5rem;
        }
        .serie-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(67,233,123,0.08);
            margin-bottom: 2rem;
            padding: 1.5rem 1.2rem;
        }
        .serie-title {
            color: #43e97b;
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }
        .ejercicios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
        }
        .ejercicio-tarjeta {
            background: #e8f9f1;
            border-radius: 20px;
            box-shadow: 0 4px 18px rgba(67,233,123,0.10);
            overflow: hidden;
            transition: box-shadow 0.3s, transform 0.3s;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .ejercicio-tarjeta:hover {
            box-shadow: 0 8px 32px rgba(67,233,123,0.18);
            transform: scale(1.03);
        }
        .ejercicio-img-pro {
            width: 100%;
            height: 220px;
            object-fit: contain;
            background: #f8f9fa;
            display: block;
        }
        .badge-video {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,0,0,0.85);
            color: white;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(255,0,0,0.12);
        }
        .ejercicio-body {
            padding: 1.2rem 1.2rem 1.2rem 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }
        .ejercicio-nombre {
            font-weight: 700;
            font-size: 1.2rem;
            color: #222;
            margin-bottom: 0.3rem;
        }
        .ejercicio-desc {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 0.7rem;
        }
        .repeticiones-box {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #222;
            font-size: 1.3rem;
            font-weight: 900;
            border-radius: 12px;
            padding: 0.5rem 1.2rem;
            margin-top: 0.5rem;
            min-width: 90px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(67,233,123,0.10);
            align-self: flex-end;
        }
        .badge.bg-primary.bg-opacity-20.text-primary.fw-bold {
            color: #fff !important;
            background: #0b6cda !important;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Crear overlay y modal dinámicamente
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = 0;
            overlay.style.left = 0;
            overlay.style.width = '100vw';
            overlay.style.height = '100vh';
            overlay.style.background = 'rgba(0,0,0,0.65)';
            overlay.style.display = 'none';
            overlay.style.zIndex = 2000;
            overlay.style.justifyContent = 'center';
            overlay.style.alignItems = 'center';
            overlay.id = 'zoomOverlay';

            const modal = document.createElement('div');
            modal.style.background = '#fff';
            modal.style.borderRadius = '24px';
            modal.style.boxShadow = '0 8px 40px rgba(0,0,0,0.18)';
            modal.style.padding = '2.5rem 2rem 2rem 2rem';
            modal.style.maxWidth = '480px';
            modal.style.width = '90vw';
            modal.style.maxHeight = '90vh';
            modal.style.overflowY = 'auto';
            modal.style.display = 'flex';
            modal.style.flexDirection = 'column';
            modal.style.alignItems = 'center';
            modal.id = 'zoomModal';
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            function closeZoom() {
                overlay.style.display = 'none';
                modal.innerHTML = '';
            }
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) closeZoom();
            });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeZoom();
            });

            document.querySelectorAll('.ejercicio-tarjeta').forEach(card => {
                card.addEventListener('click', function(e) {
                    // Evitar que el click en el enlace de video lo abra y haga zoom a la vez
                    if (e.target.closest('a')) return;
                    const img = card.querySelector('.ejercicio-img-pro').cloneNode(true);
                    img.style.width = '100%';
                    img.style.height = '320px';
                    img.style.objectFit = 'contain';
                    img.style.borderRadius = '18px';
                    img.style.marginBottom = '1.2rem';
                    const nombre = card.querySelector('.ejercicio-nombre')?.textContent || '';
                    const desc = card.querySelector('.ejercicio-desc')?.textContent || '';
                    const reps = card.querySelector('.repeticiones-box')?.textContent || '';
                    const pesoBox = card.querySelectorAll('.repeticiones-box')[1];
                    const peso = pesoBox ? pesoBox.textContent : 'Sin peso';
                    modal.innerHTML = '';
                    modal.appendChild(img);
                    const nombreDiv = document.createElement('div');
                    nombreDiv.textContent = nombre;
                    nombreDiv.style.fontWeight = 'bold';
                    nombreDiv.style.fontSize = '1.3rem';
                    nombreDiv.style.marginBottom = '0.5rem';
                    modal.appendChild(nombreDiv);
                    const descDiv = document.createElement('div');
                    descDiv.textContent = desc;
                    descDiv.style.color = '#6c757d';
                    descDiv.style.fontSize = '1rem';
                    descDiv.style.marginBottom = '0.7rem';
                    modal.appendChild(descDiv);
                    const repsDiv = document.createElement('div');
                    repsDiv.textContent = reps;
                    repsDiv.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                    repsDiv.style.color = '#222';
                    repsDiv.style.fontWeight = '900';
                    repsDiv.style.fontSize = '1.2rem';
                    repsDiv.style.borderRadius = '10px';
                    repsDiv.style.padding = '0.5rem 1.2rem';
                    repsDiv.style.textAlign = 'center';
                    modal.appendChild(repsDiv);
                    const pesoDiv = document.createElement('div');
                    pesoDiv.textContent = peso;
                    pesoDiv.style.background = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
                    pesoDiv.style.color = '#222';
                    pesoDiv.style.fontWeight = '900';
                    pesoDiv.style.fontSize = '1.2rem';
                    pesoDiv.style.borderRadius = '10px';
                    pesoDiv.style.padding = '0.5rem 1.2rem';
                    pesoDiv.style.textAlign = 'center';
                    pesoDiv.style.marginTop = '0.5rem';
                    modal.appendChild(pesoDiv);
                    const videoUrl = card.querySelector('.badge-video') ? card.querySelector('.badge-video').getAttribute('data-video-url') : null;
                    if (card.querySelector('.badge-video')) {
                        const videoBtn = document.createElement('a');
                        videoBtn.href = videoUrl || '';
                        videoBtn.target = '_blank';
                        videoBtn.textContent = 'Ver Video';
                        videoBtn.style.background = 'linear-gradient(135deg, #ff5858 0%, #f09819 100%)';
                        videoBtn.style.color = 'white';
                        videoBtn.style.fontWeight = 'bold';
                        videoBtn.style.padding = '0.6rem 1.4rem';
                        videoBtn.style.borderRadius = '8px';
                        videoBtn.style.textDecoration = 'none';
                        videoBtn.style.fontSize = '1.1rem';
                        videoBtn.style.margin = '1.2rem 0 0 0';
                        videoBtn.style.display = 'inline-block';
                        modal.appendChild(videoBtn);
                    }
                    overlay.style.display = 'flex';
                });
            });

            const botonCopiar = document.getElementById('copiarEnlaceRutina');
            if (botonCopiar) {
                botonCopiar.addEventListener('click', async () => {
                    const relativeUrl = botonCopiar.getAttribute('data-url') || window.location.pathname;
                    const fullUrl = new URL(relativeUrl, window.location.origin).toString();
                    try {
                        await navigator.clipboard.writeText(fullUrl);
                        alert('Enlace copiado.');
                    } catch (error) {
                        const tempInput = document.createElement('input');
                        tempInput.value = fullUrl;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        document.execCommand('copy');
                        tempInput.remove();
                        alert('Enlace copiado.');
                    }
                });
            }
        });
    </script>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div class="container py-4">
    <!-- Resumen de rutina -->
    <div class="rutina-header mb-4">
        <h2 th:text="${rutina.nombre}">Nombre Rutina</h2>
        <div class="info mb-2">
            <span th:text="${rutina.fechaCreacion != null ? rutina.fechaCreacion.toLocalDate() : 'Sin fecha'}">Fecha</span>
            <span class="badge bg-success ms-2" th:text="${rutina.categoria}">Categoría</span>
        </div>
        <div class="d-flex justify-content-center gap-2 flex-wrap">
            <button id="copiarEnlaceRutina"
                    type="button"
                    class="btn btn-outline-dark btn-sm"
                    th:attr="data-url=@{/rutinas/hoja/{token}(token=${rutina.tokenPublico})}">
                <i class="fas fa-link me-1"></i>Copiar enlace
            </button>
        </div>
    </div>
    <!-- Series -->
    <div th:each="serie : ${rutina.series}" class="serie-card mb-4">
        <div class="serie-title mb-3">
            <i class="fas fa-dumbbell me-2"></i>
            <span th:text="${serie.nombre}">Nombre Serie</span>
            <span class="ms-3 badge bg-primary bg-opacity-20 text-primary fw-bold" th:text="'x' + ${serie.repeticionesSerie} + ' repeticiones'"></span>
        </div>
        <div class="ejercicios-grid">
            <div th:each="serieEjercicio : ${serie.serieEjercicios}" class="ejercicio-tarjeta">
                <span th:if="${serieEjercicio.exercise.videoUrl != null and !#strings.isEmpty(serieEjercicio.exercise.videoUrl)}" class="badge-video">
                    <i class="fas fa-play-circle"></i> Video
                </span>
                <div style="display:block;position:relative;">
                    <img class="ejercicio-img-pro" th:if="${serieEjercicio.exercise.imagen != null}" th:src="${serieEjercicio.exercise.imagen.url}" alt="Imagen Ejercicio" />
                    <img class="ejercicio-img-pro" th:if="${serieEjercicio.exercise.imagen == null}" src="/img/not_imagen.png" alt="Imagen por defecto" />
                </div>
                <div class="ejercicio-body">
                    <div class="ejercicio-nombre" th:text="${serieEjercicio.exercise.name}">Nombre Ejercicio</div>
                    <div class="ejercicio-desc" th:text="${serieEjercicio.exercise.description}">Descripción</div>
                    <div class="repeticiones-box" th:text="${serieEjercicio.valor} + ' ' + ${serieEjercicio.unidad}">10 reps</div>
                    <div class="repeticiones-box" th:if="${serieEjercicio.peso != null}" th:text="${serieEjercicio.peso} + ' kg'">10 kg</div>
                    <div class="repeticiones-box" th:if="${serieEjercicio.peso == null}">Sin peso</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
